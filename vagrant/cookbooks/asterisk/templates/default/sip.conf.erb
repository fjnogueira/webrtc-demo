[general]
context=default
allowguest=no
allowoverlap=no
accept_outofcall_message=yes
outofcall_message_context=default
realm=<%= @host %>
udpbindaddr=<%= @host %>
transport=ws,wss,udp
language=en
icesupport=yes
videosupport=yes
nat=auto_force_rport,auto_comedia
allow=!all,alaw,ulaw,gsm

<% @extensions.each do |user| %>
[<%= user['username'] %>]
type=friend
username=<%= user['username'] %>
host=dynamic
secret=<%= user['password'] %>
context=<%= user['context'] %>
nat=no
disallow=all
<% if user['attributes'] %>
<% user['attributes'].each do |key, value| %>
<%= key %>=<%= value %>
<% end %>
<% else %>
encryption=yes
avpf=yes
icesupport=yes
callerid="<%= user['full_name'] %> <<%= user['username'] %>>"
directmedia=no
transport=ws,wss,udp
force_avp=yes
dtlsenable=yes
dtlsverify=no
dtlscertfile=<%= @keys_dir %>/asterisk.pem
dtlsprivatekey=<%= @keys_dir %>/asterisk.pem
dtlssetup=actpass
videosupport=yes
allow=ulaw,vp8,h264
<% end %>

<% end %>
